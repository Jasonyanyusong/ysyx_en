<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" type="image/png" href="../../res/favicon.ico"><link rel="stylesheet" href="../res/fa/all.min.css"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff"><meta rel="manifest" href="/site.webmanifest"><title>用户程序和系统调用 | 官方文档</title><meta name="description" content="">
    <link rel="modulepreload" href="../assets/app.4a525931.js"><link rel="modulepreload" href="https://ysyx.oscc.cc/docs/assets/3.3.html.60c4b9fb.js"><link rel="modulepreload" href="https://ysyx.oscc.cc/docs/assets/3.3.html.bf2039cd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.a7266140.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.232934df.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/20220828-1st-tech-forum.html.0352288d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/20230825-2nd-tech-forum.html.d1b9e033.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.1.html.b59807d6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.2.html.8bc8b9da.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.3.html.837fafd2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.4.html.4bffb007.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.5.html.ef8d5ad6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.6.html.6f0bd7f1.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.1.html.f0ea7137.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.2.html.1a53c337.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.3.html.caf2a3c8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.4.html.4cbf5a60.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.5.html.df79a509.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.6.html.86cafaf6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.7.html.8eeba125.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.1.html.e75fc45a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.2.html.d6b41a35.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.3.html.03919a0b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.4.html.c5c52d8f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.5.html.5d21687f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.1.html.4a79147b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.2.html.d9011582.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.4.html.40ffb325.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.5.html.b892d672.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.1.html.d6100612.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.2.html.f7ed61dd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.3.html.ecdf42db.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.4.html.1dbb0913.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.5.html.4f17311c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.1.html.763316a2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.2.html.a59ea17f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.3.html.76c43eb5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/FAQ.html.63b12bf4.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA0.html.f0313a46.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA1.html.711b0eac.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA2.html.5de5ea0c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA3.html.742ae6ba.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA4.html.4c56f3c8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA5.html.2e845c96.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.f63a8f2b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/SUMMARY.html.ec5ea9f0.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/blank.html.8840013e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/changelog.html.81f04b8d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/exec.html.6ad93be9.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/feedback.html.e27071f8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/git.html.1a915150.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/i386-intro.html.bdcbf94c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/install.html.8fcdb015.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/linux.html.282ef355.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/man.html.6e006172.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/nemu-isa-api.html.990fd076.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/why.html.7ff158c5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.1.html.0d459461.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.2.html.2bb2f37d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.3.html.f3366680.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.4.html.3752ac62.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.5.html.689273e3.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.6.html.8b2df824.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.1.html.0504651a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.2.html.fb1d8b3c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.3.html.529fb578.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.4.html.9e5579fc.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.5.html.baab6d8e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.6.html.2f272d90.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.7.html.4bb1ac68.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.1.html.19f46ba1.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.2.html.2df57027.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.3.html.7fd96b44.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.4.html.de4f4be8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.5.html.c00bb579.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.1.html.e031a19f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.2.html.3b0d611d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.3.html.39ad3899.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.4.html.a95da085.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.5.html.8ca71b81.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.1.html.9d707f17.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.2.html.d99be7c2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.3.html.ad2b916c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.4.html.fe3dab0c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.5.html.29b6103a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.1.html.8311ab5c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.2.html.f9c0e541.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.3.html.05e60dbb.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/FAQ.html.5728bbbc.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA0.html.677b1d1f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA1.html.c29ccb12.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA2.html.0822ebd7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA3.html.aaa28f3f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA4.html.5ee6b43b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA5.html.63c57ad2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.fe3ed219.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/SUMMARY.html.cc6af0af.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/blank.html.01771de7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/changelog.html.6878181f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/exec.html.0a4cc38f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/feedback.html.c6b019d6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/git.html.4c8ac010.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/i386-intro.html.09e89e76.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/install.html.f8cfc8fd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/linux.html.2eccd12c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/man.html.89bba41a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/nemu-isa-api.html.ee2ea84e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/why.html.6c68e2a6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.1.html.5c976ac1.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.2.html.66db2f3f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.3.html.4aac06d9.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.4.html.e05b3fae.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.5.html.2eb42db1.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.6.html.830952b9.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.7.html.154c6975.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.8.html.cd9745bd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.9.html.a68a9bf2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/advanced.html.633848dd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.1.html.d1209dc4.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.10.html.af72b9f4.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.2.html.5e6f403b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.3.html.a86ca13a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.4.html.c8ea1de9.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.5.html.c486e237.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.6.html.17ca572d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.7.html.7080b768.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.8.html.7502ac87.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.9.html.bedcb78f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/baseline.html.3e2909ae.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.1.html.73f0d75e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.2.html.899db208.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.3.html.25cabbbb.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.4.html.2cbf3a34.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.5.html.a6bbf717.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.6.html.5ec49f77.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.7.html.6408936c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/prestudy.html.a9250176.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.1.html.4463740c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.2.html.d1e36fd2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.3.html.ae57c7b7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.4.html.6c63dbcc.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.5.html.ae2cdc09.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.6.html.d86fb91e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/specialist.html.69d2f484.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.7db9802e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/schedule-origin.html.6f8a7a8c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/schedule.html.2b0c5ddc.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.1.html.277e5588.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.2.html.77ed5027.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.3.html.c002cd7b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.4.html.af2e37c7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.5.html.ce15f76b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.6.html.04203cf4.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.7.html.3f64070f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.8.html.f2613449.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.9.html.6b985c58.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/advanced.html.65e379b5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.2995e200.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.1.html.583540ad.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.2.html.c221742a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.3.html.f4c8a5e5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.4.html.a76cfae7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.5.html.57aaf57c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.6.html.4fd2530f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.7.html.8a297aa0.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/prestudy.html.867e5d4c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.1.html.e2efd6a7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.2.html.aefd1e74.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.3.html.46b068a0.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.4.html.f550e424.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.5.html.a68ea659.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/baseline.html.619d3b2a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/soc.1.html.afb02b35.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/soc.2.html.f7df462f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/soc.3.html.e14cfa2a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/soc.4.html.ef83adf5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/ask.html.7c717162.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.1.html.4b1c8ec7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.2.html.2fa39d0f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.3.html.409b7b55.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.4.html.42646124.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.5.html.3a73f236.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.6.html.8e8c660b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/specialist.html.3efa6e29.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/faq.html.70d41486.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/student.html.8ffc0d97.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/notice.html.12c7f762.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/meaning-goal.html.86dddc36.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/overview.html.fab21fcd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/pass.html.9faccc41.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/training-concept.html.07c7d25c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/assistant.html.ab9ff4a0.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/notice.html.497a2ada.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/support.html.a0e77657.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/404.html.ce538133.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.cf814034.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.7a821f23.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/20220828-1st-tech-forum.html.686d7136.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/20230825-2nd-tech-forum.html.f5771670.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.1.html.e8dafc44.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.2.html.c1a3a5c8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.3.html.d39c2034.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.4.html.4bc666d2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.5.html.dba9e3d2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.6.html.f6ff707e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.1.html.c21b4394.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.2.html.a1a8df20.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.3.html.0bf7a167.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.4.html.ae74c2b2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.5.html.f40c8ae0.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.6.html.17832a39.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.7.html.a8c86a81.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.1.html.6d44643a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.2.html.443e26a6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.3.html.e1e938ec.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.4.html.1f907af1.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.5.html.2d383856.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.1.html.cbf5cdab.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.2.html.27c85899.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.4.html.bda34a22.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.5.html.4124a18f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.1.html.7555d79b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.2.html.c4a6353d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.3.html.7f7aa959.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.4.html.3c240e28.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.5.html.df1ba6e4.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.1.html.6c462bbc.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.2.html.d14de6d8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.3.html.8b52ccd1.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/FAQ.html.e6a44f5f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA0.html.2ef80bf5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA1.html.891782b4.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA2.html.9658a1f2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA3.html.d1b8800a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA4.html.950d2e14.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA5.html.803dd116.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.511193b6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/SUMMARY.html.b1b9fd0f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/blank.html.281c2647.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/changelog.html.df9df882.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/exec.html.3d818a5c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/feedback.html.bdf42a97.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/git.html.6dee9910.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/i386-intro.html.cc3d6f08.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/install.html.ca20ca3b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/linux.html.982cb2be.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/man.html.78c8d359.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/nemu-isa-api.html.39ea2347.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/why.html.0f36cdb7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.1.html.352b1ee5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.2.html.f097f5f7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.3.html.6163e6cd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.4.html.a6ae9139.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.5.html.610f7dc5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.6.html.d728a707.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.1.html.c5ec55ed.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.2.html.cfa4dabf.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.3.html.68177e2a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.4.html.2dda1d06.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.5.html.a5a0e665.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.6.html.378e72eb.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.7.html.4b625448.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.1.html.806caf93.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.2.html.86a4b0f2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.3.html.32aa5d26.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.4.html.f35b7445.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.5.html.717e4c76.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.1.html.4fa6f565.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.2.html.52e6ba49.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.3.html.e20d38cc.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.4.html.a96a451c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.5.html.fb745285.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.1.html.a280e6c2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.2.html.fff6883e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.3.html.ff9fbed3.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.4.html.ff8add10.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/4.5.html.55ea5ab1.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.1.html.41b33646.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.2.html.b52ba57d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/5.3.html.c9dbb4ee.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/FAQ.html.fd208f3b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA0.html.1a552340.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA1.html.c7feba93.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA2.html.bc1f14af.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA3.html.41b913b0.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA4.html.5795ee2c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/PA5.html.b1b4ef4f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.2f4f0270.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/SUMMARY.html.641d7708.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/blank.html.1aa151fe.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/changelog.html.af92abe2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/exec.html.3d563957.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/feedback.html.0982b9a7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/git.html.894286f9.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/i386-intro.html.5f6ebfe8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/install.html.6820135d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/linux.html.92f11c92.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/man.html.0b859cb2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/nemu-isa-api.html.65a8ec7b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/why.html.dcd9327f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.1.html.cec3e29d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.2.html.a08b9c2f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.3.html.2e08d202.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.4.html.6cfe35a7.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.5.html.107ccf2f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.6.html.358e830c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.7.html.99f5d2da.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.8.html.5f125032.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.9.html.d3bbba57.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/advanced.html.0e654d5c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.1.html.b0bca01c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.10.html.e5e078aa.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.2.html.ba4ab312.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.3.html.546f9c64.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.4.html.fbcf467d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.5.html.2acafdfa.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.6.html.d966fecb.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.7.html.14b3bf1d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.8.html.de83bd00.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.9.html.1a542954.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/baseline.html.92dfeabf.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.1.html.6aeaccaf.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.2.html.c368f429.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.3.html.dfdd0db6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.4.html.290587b2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.5.html.f00f6f04.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.6.html.a074c18d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.7.html.46e71345.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/prestudy.html.afef3155.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.1.html.cdc53db6.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.2.html.23ebb3dd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.3.html.85c3bd36.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.4.html.b88be577.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.5.html.ff515b78.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.6.html.b41b68ca.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/specialist.html.26bdf948.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.878255da.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/schedule-origin.html.eacc721e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/schedule.html.75d22e8d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.1.html.4a82c235.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.2.html.2efb3275.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.3.html.47c8c0e8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.4.html.55da5ce3.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.5.html.7c06d8b5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.6.html.ed6d8049.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.7.html.c62fc84b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.8.html.90b91f6a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/2.9.html.1a5b8c85.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/advanced.html.7f4bb1ce.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/index.html.26370994.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.1.html.126c2f34.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.2.html.9e240aae.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.3.html.11cc66de.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.4.html.38669bc0.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.5.html.db19d255.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.6.html.7fa636ec.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/0.7.html.1d859400.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/prestudy.html.4ec5d8de.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.1.html.3df341b2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.2.html.d6a68a54.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.3.html.4e944541.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.4.html.e3d83b6a.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/1.5.html.f2a503c2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/baseline.html.1963ceb8.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/soc.1.html.1ecb1941.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/soc.2.html.d102f9fc.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/soc.3.html.00e9d91f.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/soc.4.html.8305527d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/ask.html.b699966b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.1.html.1c7a13e2.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.2.html.fdca3095.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.3.html.a7f3f20d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.4.html.600be615.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.5.html.5830d684.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/3.6.html.ae89b90d.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/specialist.html.9aabba01.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/faq.html.caad27ac.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/student.html.7e730436.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/notice.html.17a148ae.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/meaning-goal.html.a9225751.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/overview.html.6004fd9b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/pass.html.8d48939e.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/training-concept.html.01972c26.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/assistant.html.44c3fbb5.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/notice.html.2bcb6cfd.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/support.html.3242a66b.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/404.html.40b8a745.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/404.4e6b58b0.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/Layout.c0ed3a05.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/Container.3cafa256.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/Responsive.dde7be9c.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/Badge.ce404839.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/TriStateLink.74a9f928.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/Button.0f341231.js"><link rel="prefetch" href="https://ysyx.oscc.cc/docs/assets/MjxContainer.f281b7b6.js">
    <link rel="stylesheet" href="../assets/style.43f1000b.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><div><span class="can-hide site-name">第六期</span><img class="logo" src="../res/logo.png" alt="官方文档" style="margin-right:0px;position:relative;top:1px;"><span class="can-hide site-name">学习讲义</span></div></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="课程主页"><span class="title">课程主页</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="课程主页"><span class="title">课程主页</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="https://ysyx.oscc.cc/docs/" class="" aria-label="第六期"><!--[--><!--]--> 第六期 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="https://ysyx.oscc.cc/docs/2205" class="" aria-label="第五期"><!--[--><!--]--> 第五期 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习讲义"><span class="title">学习讲义</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习讲义"><span class="title">学习讲义</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/prestudy" class="" aria-label="预学习阶段"><!--[--><!--]--> 预学习阶段 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.1.html" class="" aria-label="如何科学地提问"><!--[--><!--]--> 如何科学地提问 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.2.html" class="" aria-label="Linux系统安装和基本使用"><!--[--><!--]--> Linux系统安装和基本使用 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.3.html" class="" aria-label="复习C语言"><!--[--><!--]--> 复习C语言 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.4.html" class="" aria-label="搭建verilator仿真环境"><!--[--><!--]--> 搭建verilator仿真环境 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.5.html" class="" aria-label="数字电路基础实验"><!--[--><!--]--> 数字电路基础实验 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.6.html" class="" aria-label="完成PA1"><!--[--><!--]--> 完成PA1 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.7.html" class="" aria-label="提交入学答辩申请"><!--[--><!--]--> 提交入学答辩申请 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="https://ysyx.oscc.cc/docs/2306/baseline/baseline" class="" aria-label="基础阶段"><!--[--><!--]--> 基础阶段 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.1.html" class="" aria-label="支持RV32IM的NEMU"><!--[--><!--]--> 支持RV32IM的NEMU <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.2.html" class="" aria-label="用RTL实现最简单的处理器"><!--[--><!--]--> 用RTL实现最简单的处理器 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.3.html" class="" aria-label="运行时环境和基础设施"><!--[--><!--]--> 运行时环境和基础设施 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.4.html" class="" aria-label="支持RV32E的单周期NPC"><!--[--><!--]--> 支持RV32E的单周期NPC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.5.html" class="" aria-label="设备和输入输出"><!--[--><!--]--> 设备和输入输出 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.6.html" class="" aria-label="简单的异常处理机制"><!--[--><!--]--> 简单的异常处理机制 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.7.html" class="" aria-label="总线"><!--[--><!--]--> 总线 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.8.html" class="" aria-label="SoC计算机系统"><!--[--><!--]--> SoC计算机系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.9.html" class="" aria-label="性能和简单缓存"><!--[--><!--]--> 性能和简单缓存 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.10.html" class="" aria-label="流水线处理器"><!--[--><!--]--> 流水线处理器 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其它资料"><span class="title">其它资料</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其它资料"><span class="title">其它资料</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="https://ysyx.oscc.cc/docs/ics-pa" class="router-link-active" aria-label="南京大学&quot;计算机系统基础&quot;实验(PA)"><!--[--><!--]--> 南京大学&quot;计算机系统基础&quot;实验(PA) <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="PA0.html" class="" aria-label="PA0 - 世界诞生的前夜: 开发环境配置"><!--[--><!--]--> PA0 - 世界诞生的前夜: 开发环境配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="PA1.html" class="" aria-label="PA1 - 开天辟地的篇章: 最简单的计算机"><!--[--><!--]--> PA1 - 开天辟地的篇章: 最简单的计算机 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="PA2.html" class="" aria-label="PA2 - 简单复杂的机器: 冯诺依曼计算机系统"><!--[--><!--]--> PA2 - 简单复杂的机器: 冯诺依曼计算机系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="PA3.html" class="" aria-label="PA3 - 穿越时空的旅程: 批处理系统"><!--[--><!--]--> PA3 - 穿越时空的旅程: 批处理系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="PA4.html" class="" aria-label="PA4 - 虚实交错的魔法: 分时多任务"><!--[--><!--]--> PA4 - 虚实交错的魔法: 分时多任务 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><div style="height:100%;display:flex;margin:0 0 0 1em;align-items:center;"><!----></div><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="课程主页"><span class="title">课程主页</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="课程主页"><span class="title">课程主页</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="https://ysyx.oscc.cc/docs/" class="" aria-label="第六期"><!--[--><!--]--> 第六期 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="https://ysyx.oscc.cc/docs/2205" class="" aria-label="第五期"><!--[--><!--]--> 第五期 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习讲义"><span class="title">学习讲义</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习讲义"><span class="title">学习讲义</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/prestudy" class="" aria-label="预学习阶段"><!--[--><!--]--> 预学习阶段 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.1.html" class="" aria-label="如何科学地提问"><!--[--><!--]--> 如何科学地提问 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.2.html" class="" aria-label="Linux系统安装和基本使用"><!--[--><!--]--> Linux系统安装和基本使用 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.3.html" class="" aria-label="复习C语言"><!--[--><!--]--> 复习C语言 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.4.html" class="" aria-label="搭建verilator仿真环境"><!--[--><!--]--> 搭建verilator仿真环境 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.5.html" class="" aria-label="数字电路基础实验"><!--[--><!--]--> 数字电路基础实验 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.6.html" class="" aria-label="完成PA1"><!--[--><!--]--> 完成PA1 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/prestudy/0.7.html" class="" aria-label="提交入学答辩申请"><!--[--><!--]--> 提交入学答辩申请 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="https://ysyx.oscc.cc/docs/2306/baseline/baseline" class="" aria-label="基础阶段"><!--[--><!--]--> 基础阶段 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.1.html" class="" aria-label="支持RV32IM的NEMU"><!--[--><!--]--> 支持RV32IM的NEMU <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.2.html" class="" aria-label="用RTL实现最简单的处理器"><!--[--><!--]--> 用RTL实现最简单的处理器 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.3.html" class="" aria-label="运行时环境和基础设施"><!--[--><!--]--> 运行时环境和基础设施 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.4.html" class="" aria-label="支持RV32E的单周期NPC"><!--[--><!--]--> 支持RV32E的单周期NPC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.5.html" class="" aria-label="设备和输入输出"><!--[--><!--]--> 设备和输入输出 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.6.html" class="" aria-label="简单的异常处理机制"><!--[--><!--]--> 简单的异常处理机制 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.7.html" class="" aria-label="总线"><!--[--><!--]--> 总线 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.8.html" class="" aria-label="SoC计算机系统"><!--[--><!--]--> SoC计算机系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.9.html" class="" aria-label="性能和简单缓存"><!--[--><!--]--> 性能和简单缓存 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="https://ysyx.oscc.cc/docs/2306/baseline/1.10.html" class="" aria-label="流水线处理器"><!--[--><!--]--> 流水线处理器 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其它资料"><span class="title">其它资料</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其它资料"><span class="title">其它资料</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="https://ysyx.oscc.cc/docs/ics-pa" class="router-link-active" aria-label="南京大学&quot;计算机系统基础&quot;实验(PA)"><!--[--><!--]--> 南京大学&quot;计算机系统基础&quot;实验(PA) <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="PA0.html" class="" aria-label="PA0 - 世界诞生的前夜: 开发环境配置"><!--[--><!--]--> PA0 - 世界诞生的前夜: 开发环境配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="PA1.html" class="" aria-label="PA1 - 开天辟地的篇章: 最简单的计算机"><!--[--><!--]--> PA1 - 开天辟地的篇章: 最简单的计算机 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="PA2.html" class="" aria-label="PA2 - 简单复杂的机器: 冯诺依曼计算机系统"><!--[--><!--]--> PA2 - 简单复杂的机器: 冯诺依曼计算机系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="PA3.html" class="" aria-label="PA3 - 穿越时空的旅程: 批处理系统"><!--[--><!--]--> PA3 - 穿越时空的旅程: 批处理系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="PA4.html" class="" aria-label="PA4 - 虚实交错的魔法: 分时多任务"><!--[--><!--]--> PA4 - 虚实交错的魔法: 分时多任务 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="index.html" class="router-link-active sidebar-item sidebar-heading" aria-label="南京大学 &quot;计算机系统基础&quot; 实验"><!--[--><!--]--> 南京大学 &quot;计算机系统基础&quot; 实验 <!--[--><!--]--></a><!----></li><li><a href="PA0" class="sidebar-item sidebar-heading" aria-label="PA0 - 世界诞生的前夜: 开发环境配置"><!--[--><!--]--> PA0 - 世界诞生的前夜: 开发环境配置 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="0.1.html" class="sidebar-item" aria-label="Preparation"><!--[--><!--]--> Preparation <!--[--><!--]--></a><!----></li><li><a href="0.2.html" class="sidebar-item" aria-label="First Exploration with GNU/Linux"><!--[--><!--]--> First Exploration with GNU/Linux <!--[--><!--]--></a><!----></li><li><a href="0.3.html" class="sidebar-item" aria-label="Installing Tools"><!--[--><!--]--> Installing Tools <!--[--><!--]--></a><!----></li><li><a href="0.4.html" class="sidebar-item" aria-label="Configuring vim"><!--[--><!--]--> Configuring vim <!--[--><!--]--></a><!----></li><li><a href="0.5.html" class="sidebar-item" aria-label="More Exploration"><!--[--><!--]--> More Exploration <!--[--><!--]--></a><!----></li><li><a href="0.6.html" class="sidebar-item" aria-label="Getting Source Code for PAs"><!--[--><!--]--> Getting Source Code for PAs <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="PA1" class="sidebar-item sidebar-heading" aria-label="PA1 - 开天辟地的篇章: 最简单的计算机"><!--[--><!--]--> PA1 - 开天辟地的篇章: 最简单的计算机 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="1.1.html" class="sidebar-item" aria-label="在开始愉快的PA之旅之前"><!--[--><!--]--> 在开始愉快的PA之旅之前 <!--[--><!--]--></a><!----></li><li><a href="1.2.html" class="sidebar-item" aria-label="开天辟地的篇章"><!--[--><!--]--> 开天辟地的篇章 <!--[--><!--]--></a><!----></li><li><a href="1.3.html" class="sidebar-item" aria-label="RTFSC"><!--[--><!--]--> RTFSC <!--[--><!--]--></a><!----></li><li><a href="1.4.html" class="sidebar-item" aria-label="基础设施: 简易调试器"><!--[--><!--]--> 基础设施: 简易调试器 <!--[--><!--]--></a><!----></li><li><a href="1.5.html" class="sidebar-item" aria-label="表达式求值"><!--[--><!--]--> 表达式求值 <!--[--><!--]--></a><!----></li><li><a href="1.6.html" class="sidebar-item" aria-label="监视点"><!--[--><!--]--> 监视点 <!--[--><!--]--></a><!----></li><li><a href="1.7.html" class="sidebar-item" aria-label="如何阅读手册"><!--[--><!--]--> 如何阅读手册 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="PA2" class="sidebar-item sidebar-heading" aria-label="PA2 - 简单复杂的机器: 冯诺依曼计算机系统"><!--[--><!--]--> PA2 - 简单复杂的机器: 冯诺依曼计算机系统 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="2.1.html" class="sidebar-item" aria-label="不停计算的机器"><!--[--><!--]--> 不停计算的机器 <!--[--><!--]--></a><!----></li><li><a href="2.2.html" class="sidebar-item" aria-label="RTFM"><!--[--><!--]--> RTFM <!--[--><!--]--></a><!----></li><li><a href="2.3.html" class="sidebar-item" aria-label="程序, 运行时环境与AM"><!--[--><!--]--> 程序, 运行时环境与AM <!--[--><!--]--></a><!----></li><li><a href="2.4.html" class="sidebar-item" aria-label="基础设施(2)"><!--[--><!--]--> 基础设施(2) <!--[--><!--]--></a><!----></li><li><a href="2.5.html" class="sidebar-item" aria-label="输入输出"><!--[--><!--]--> 输入输出 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="PA3" class="sidebar-item sidebar-heading active" aria-label="PA3 - 穿越时空的旅程: 批处理系统"><!--[--><!--]--> PA3 - 穿越时空的旅程: 批处理系统 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a href="3.1.html" class="sidebar-item" aria-label="批处理系统"><!--[--><!--]--> 批处理系统 <!--[--><!--]--></a><!----></li><li><a href="3.2.html" class="sidebar-item" aria-label="穿越时空的旅程"><!--[--><!--]--> 穿越时空的旅程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="3.3.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="用户程序和系统调用"><!--[--><!--]--> 用户程序和系统调用 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="3.3.html#加载第一个用户程序" class="router-link-active router-link-exact-active sidebar-item" aria-label="加载第一个用户程序"><!--[--><!--]--> 加载第一个用户程序 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="3.3.html#操作系统的运行时环境" class="router-link-active router-link-exact-active sidebar-item" aria-label="操作系统的运行时环境"><!--[--><!--]--> 操作系统的运行时环境 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="3.3.html#系统调用" class="router-link-active router-link-exact-active sidebar-item" aria-label="系统调用"><!--[--><!--]--> 系统调用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="3.3.html#系统调用的踪迹-strace" class="router-link-active router-link-exact-active sidebar-item" aria-label="系统调用的踪迹 - strace"><!--[--><!--]--> 系统调用的踪迹 - strace <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="3.3.html#操作系统之上的trm" class="router-link-active router-link-exact-active sidebar-item" aria-label="操作系统之上的TRM"><!--[--><!--]--> 操作系统之上的TRM <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="3.4.html" class="sidebar-item" aria-label="简易文件系统"><!--[--><!--]--> 简易文件系统 <!--[--><!--]--></a><!----></li><li><a href="3.5.html" class="sidebar-item" aria-label="精彩纷呈的应用程序"><!--[--><!--]--> 精彩纷呈的应用程序 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="PA4" class="sidebar-item sidebar-heading" aria-label="PA4 - 虚实交错的魔法: 分时多任务"><!--[--><!--]--> PA4 - 虚实交错的魔法: 分时多任务 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="4.1.html" class="sidebar-item" aria-label="多道程序"><!--[--><!--]--> 多道程序 <!--[--><!--]--></a><!----></li><li><a href="4.2.html" class="sidebar-item" aria-label="程序和内存位置"><!--[--><!--]--> 程序和内存位置 <!--[--><!--]--></a><!----></li><li><a href="4.3.html" class="sidebar-item" aria-label="超越容量的界限"><!--[--><!--]--> 超越容量的界限 <!--[--><!--]--></a><!----></li><li><a href="4.4.html" class="sidebar-item" aria-label="分时多任务"><!--[--><!--]--> 分时多任务 <!--[--><!--]--></a><!----></li><li><a href="4.5.html" class="sidebar-item" aria-label="编写不朽的传奇"><!--[--><!--]--> 编写不朽的传奇 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="blank" class="sidebar-item sidebar-heading" aria-label="杂项"><!--[--><!--]--> 杂项 <!--[--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="FAQ.html" class="sidebar-item" aria-label="常见问题(FAQ)"><!--[--><!--]--> 常见问题(FAQ) <!--[--><!--]--></a><!----></li><li><a href="why.html" class="sidebar-item" aria-label="为什么要学习计算机系统基础"><!--[--><!--]--> 为什么要学习计算机系统基础 <!--[--><!--]--></a><!----></li><li><a href="linux.html" class="sidebar-item" aria-label="Linux入门教程"><!--[--><!--]--> Linux入门教程 <!--[--><!--]--></a><!----></li><li><a href="man.html" class="sidebar-item" aria-label="man快速入门"><!--[--><!--]--> man快速入门 <!--[--><!--]--></a><!----></li><li><a href="git.html" class="sidebar-item" aria-label="git快速入门"><!--[--><!--]--> git快速入门 <!--[--><!--]--></a><!----></li><li><a href="nemu-isa-api.html" class="sidebar-item" aria-label="NEMU ISA相关的API说明文档"><!--[--><!--]--> NEMU ISA相关的API说明文档 <!--[--><!--]--></a><!----></li><li><a href="changelog.html" class="sidebar-item" aria-label="更新日志"><!--[--><!--]--> 更新日志 <!--[--><!--]--></a><!----></li><li><a href="i386-intro.html" class="sidebar-item" aria-label="x86指令系统简介"><!--[--><!--]--> x86指令系统简介 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="用户程序和系统调用" tabindex="-1"><a class="header-anchor" href="3.3.html#用户程序和系统调用" aria-hidden="true">#</a> 用户程序和系统调用</h1><p>有了自陷指令, 用户程序就可以将执行流切换到操作系统指定的入口了. 现在我们来解决实现批处理系统的第二个问题: 如何加载用户程序.</p><h3 id="加载第一个用户程序" tabindex="-1"><a class="header-anchor" href="3.3.html#加载第一个用户程序" aria-hidden="true">#</a> 加载第一个用户程序</h3><p>在操作系统中, 加载用户程序是由loader(加载器)模块负责的. 我们知道程序中包括代码和数据, 它们都是存储在可执行文件中. 加载的过程就是把可执行文件中的代码和数据放置在正确的内存位置, 然后跳转到程序入口, 程序就开始执行了. 更具体的, 为了实现<code>loader()</code>函数, 我们需要解决以下问题:</p><ul><li>可执行文件在哪里?</li><li>代码和数据在可执行文件的哪个位置?</li><li>代码和数据有多少?</li><li>&quot;正确的内存位置&quot;在哪里?</li></ul><p>为了回答第一个问题, 我们还要先说明一下用户程序是从哪里来的. 用户程序运行在操作系统之上, 由于运行时环境的差异, 我们不能把编译到AM上的程序放到操作系统上运行. 为此, 我们准备了一个新的子项目Navy-apps, 专门用于编译出操作系统的用户程序. 通过执行以下命令获取Navy的框架代码:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ics2022
<span class="token function">bash</span> init.sh navy-apps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Navy子项目的结构组织如下, 更多的说明可以阅读<code>README.md</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>navy-apps
├── apps            # 用户程序
│   ├── am-kernels
│   ├── busybox
│   ├── fceux
│   ├── lua
│   ├── menu
│   ├── nplayer
│   ├── nslider
│   ├── nterm
│   ├── nwm
│   ├── onscripter
│   ├── oslab0
│   └── pal         # 仙剑奇侠传
├── fsimg           # 根文件系统
├── libs            # 运行库
│   ├── libc        # Newlib C库
│   ├── libam
│   ├── libbdf
│   ├── libbmp
│   ├── libfixedptc
│   ├── libminiSDL
│   ├── libndl
│   ├── libos       # 系统调用的用户层封装
│   ├── libSDL_image
│   ├── libSDL_mixer
│   ├── libSDL_ttf
│   └── libvorbis
├── Makefile
├── README.md
├── scripts
└── tests           # 一些测试
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Navy的<code>Makefile</code>组织和<code>abstract-machine</code>非常类似, 你应该很容易理解它. 其中, <code>navy-apps/libs/libc</code>中是一个名为<a href="https://sourceware.org/newlib/" target="_blank" rel="noopener noreferrer">Newlib<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>的项目, 它是一个专门为嵌入式系统提供的C库, 库中的函数对运行时环境的要求极低. 这对Nanos-lite来说是非常友好的, 我们不必为了配合C库而在Nanos-lite中实现额外的功能. 用户程序的入口位于<code>navy-apps/libs/libos/src/crt0/start.S</code>中的<code>_start()</code>函数, 这里的<code>crt</code>是<code>C RunTime</code>的缩写, <code>0</code>的含义表示最开始. <code>_start()</code>函数会调用<code>navy-apps/libs/libos/src/crt0/crt0.c</code>中的<code>call_main()</code>函数, 然后调用用户程序的<code>main()</code>函数, 从<code>main()</code>函数返回后会调用<code>exit()</code>结束运行.</p><div class="custom-container c-red"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-bullhorn"></i> C库的代码&quot;总是&quot;对的</h4></span><p>有同学曾经在调bug时认为是C库的代码有bug, 对C库的代码进行修改之后, 果然就可以成功运行了. 事实上, PA的必做内容并不需要修改C库的代码. 修改C库代码使得程序运行成功, 说明有bug的还是你的代码. 修改C库的方式只是在绕开一个你已经发现的bug, 它并没有被解决, 而是回到潜伏的状态, 你很可能会在将来再次遇到它, 解决它所付出的代码也许会更大, 而且遇到的时候你还很难确定它们是不是同一个bug.</p><p>总之, 当你决定要投机取巧的时候, 你需要先冷静分析得失, 再做决定.</p></div><p>我们要在Nanos-lite上运行的第一个用户程序是<code>navy-apps/tests/dummy/dummy.c</code>. 为了避免和Nanos-lite的内容产生冲突, 我们约定目前用户程序需要被链接到内存位置<code>0x3000000</code>(x86)或<code>0x83000000</code>(mips32或riscv32)附近, Navy已经设置好了相应的选项(见<code>navy-apps/scripts/$ISA.mk</code>中的<code>LDFLAGS</code>变量). 为了编译dummy, 在<code>navy-apps/tests/dummy/</code>目录下执行</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>make ISA=$ISA
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>首次在Navy中编译时会从github上获取Newlib等项目并编译, 编译过程中会出现较多warning, 目前可以忽略它们. 编译成功后把<code>navy-apps/tests/dummy/build/dummy-$ISA</code>手动复制并重命名为<code>nanos-lite/build/ramdisk.img</code>, 然后在<code>nanos-lite/</code>目录下执行</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>make ARCH=$ISA-nemu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>会生成Nanos-lite的可执行文件, 编译期间会把ramdisk镜像文件<code>nanos-lite/build/ramdisk.img</code> 包含进Nanos-lite成为其中的一部分(在<code>nanos-lite/src/resources.S</code>中实现). 现在的ramdisk十分简单, 它只有一个文件, 就是我们将要加载的用户程序<code>dummy</code>, 这其实已经回答了上述第一个问题: 可执行文件位于ramdisk偏移为0处, 访问它就可以得到用户程序的第一个字节.</p><p>为了回答剩下的问题, 我们首先需要了解可执行文件是如何组织的. 你应该已经在课堂上学习过ELF文件格式了, 它除了包含程序本身的代码和静态数据之外, 还包括一些用来描述它们的信息, 否则我们连代码和数据之间的分界线在哪里都不知道. 这些信息描述了可执行文件的组织形式, 不同组织形式形成了不同格式的可执行文件, 例如Windows主流的可执行文件是<a href="http://en.wikipedia.org/wiki/Portable_Executable" target="_blank" rel="noopener noreferrer">PE(Portable Executable)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>格式, 而GNU/Linux主要使用<a href="http://en.wikipedia.org/wiki/Executable_and_Linkable_Format" target="_blank" rel="noopener noreferrer">ELF(Executable and Linkable Format)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>格式. 因此一般情况下, 你不能在Windows下把一个可执行文件拷贝到GNU/Linux下执行, 反之亦然. ELF是GNU/Linux可执行文件的标准格式, 这是因为GNU/Linux遵循System V ABI(<a href="http://stackoverflow.com/questions/2171177/what-is-application-binary-interface-abi" target="_blank" rel="noopener noreferrer">Application Binary Interface<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>).</p><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-question-circle"></i> 堆和栈在哪里?</h4></span><p>我们提到了代码和数据都在可执行文件里面, 但却没有提到堆(heap)和栈(stack). 为什么堆和栈的内容没有放入可执行文件里面? 那程序运行时刻用到的堆和栈又是怎么来的? AM的代码是否能给你带来一些启发?</p></div><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-question-circle"></i> 如何识别不同格式的可执行文件?</h4></span><p>如果你在GNU/Linux下执行一个从Windows拷过来的可执行文件, 将会报告&quot;格式错误&quot;. 思考一下, GNU/Linux是如何知道&quot;格式错误&quot;的?</p></div><p>ELF文件提供了两个视角来组织一个可执行文件, 一个是面向链接过程的section视角, 这个视角提供了用于链接与重定位的信息(例如符号表); 另一个是面向执行的segment视角, 这个视角提供了用于加载可执行文件的信息. 通过<code>readelf</code>命令, 我们还可以看到section和segment之间的映射关系: 一个segment可能由0个或多个section组成, 但一个section可能不被包含于任何segment中.</p><p>我们现在关心的是如何加载程序, 因此我们重点关注segment的视角. ELF中采用program header table来管理segment, program header table的一个表项描述了一个segment的所有属性, 包括类型, 虚拟地址, 标志, 对齐方式, 以及文件内偏移量和segment大小. 根据这些信息, 我们就可以知道需要加载可执行文件的哪些字节了, 同时我们也可以看到, 加载一个可执行文件并不是加载它所包含的所有内容, 只要加载那些与运行时刻相关的内容就可以了, 例如调试信息和符号表就不必加载. 我们可以通过判断segment的<code>Type</code>属性是否为<code>PT_LOAD</code>来判断一个segment是否需要加载.</p><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-question-circle"></i> 冗余的属性?</h4></span><p>使用<code>readelf</code>查看一个ELF文件的信息, 你会看到一个segment包含两个大小的属性, 分别是<code>FileSiz</code>和<code>MemSiz</code>, 这是为什么? 再仔细观察一下, 你会发现<code>FileSiz</code>通常不会大于相应的<code>MemSiz</code>, 这又是为什么?</p></div><p>我们通过下面的图来说明如何根据segment的属性来加载它:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>      +-------+---------------+-----------------------+
      |       |...............|                       |
      |       |...............|                       |  ELF file
      |       |...............|                       |
      +-------+---------------+-----------------------+
      0       ^               |              
              |&lt;------+------&gt;|       
              |       |       |             
              |       |                            
              |       +----------------------------+       
              |                                    |       
   Type       |   Offset    VirtAddr    PhysAddr   |FileSiz  MemSiz   Flg  Align
   LOAD       +-- 0x001000  0x03000000  0x03000000 +0x1d600  0x27240  RWE  0x1000
                               |                       |       |     
                               |   +-------------------+       |     
                               |   |                           |     
                               |   |     |           |         |       
                               |   |     |           |         |      
                               |   |     +-----------+ ---     |     
                               |   |     |00000000000|  ^      |   
                               |   | --- |00000000000|  |      |    
                               |   |  ^  |...........|  |      |  
                               |   |  |  |...........|  +------+
                               |   +--+  |...........|  |      
                               |      |  |...........|  |     
                               |      v  |...........|  v    
                               +-------&gt; +-----------+ ---  
                                         |           |     
                                         |           |    
                                            Memory  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你需要找出每一个需要加载的segment的<code>Offset</code>, <code>VirtAddr</code>, <code>FileSiz</code>和<code>MemSiz</code>这些参数. 其中相对文件偏移<code>Offset</code>指出相应segment的内容从ELF文件的第<code>Offset</code>字节开始, 在文件中的大小为<code>FileSiz</code>, 它需要被分配到以<code>VirtAddr</code>为首地址的虚拟内存位置, 在内存中它占用大小为<code>MemSiz</code>. 也就是说, 这个segment使用的内存就是<code>[VirtAddr, VirtAddr + MemSiz)</code>这一连续区间, 然后将segment的内容从ELF文件中读入到这一内存区间, 并将<code>[VirtAddr + FileSiz, VirtAddr + MemSiz)</code>对应的物理区间清零.</p><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-question-circle"></i> 为什么要清零?</h4></span><p>为什么需要将 <code>[VirtAddr + FileSiz, VirtAddr + MemSiz)</code> 对应的物理区间清零?</p></div><p>关于程序从何而来, 可以参考一篇文章: <a href="http://www.tenouk.com/ModuleW.html" target="_blank" rel="noopener noreferrer">COMPILER, ASSEMBLER, LINKER AND LOADER: A BRIEF STORY<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. 如果你希望查阅更多与ELF文件相关的信息, 请参考</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>man 5 elf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>由于ELF文件在ramdisk中, 框架代码提供了一些ramdisk相关的函数(在<code>nanos-lite/src/ramdisk.c</code>中定义), 你可以使用它们来实现loader的功能:</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// 从ramdisk中`offset`偏移处的`len`字节读入到`buf`中</span>
<span class="token class-name">size_t</span> <span class="token function">ramdisk_read</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> offset<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 把`buf`中的`len`字节写入到ramdisk中`offset`偏移处</span>
<span class="token class-name">size_t</span> <span class="token function">ramdisk_write</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> offset<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 返回ramdisk的大小, 单位为字节</span>
<span class="token class-name">size_t</span> <span class="token function">get_ramdisk_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>事实上, loader的工作向我们展现出了程序的最为原始的状态: 比特串! 加载程序其实就是把这一毫不起眼的比特串放置在正确的位置, 但这其中又折射出&quot;存储程序&quot;的划时代思想: 当操作系统将控制权交给它的时候, 计算机把它解释成指令并逐条执行. loader让计算机的生命周期突破程序的边界: 一个程序结束并不意味着计算机停止工作, 计算机将终其一生履行执行程序的使命.</p><div class="custom-container c-yellow"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 实现loader</h4></span><p>你需要在Nanos-lite中实现loader的功能, 来把用户程序加载到正确的内存位置, 然后执行用户程序. <code>loader()</code>函数在<code>nanos-lite/src/loader.c</code>中定义, 其中的<code>pcb</code>参数目前暂不使用, 可以忽略, 而因为ramdisk中目前只有一个文件, <code>filename</code>参数也可以忽略. 在下一个阶段实现文件系统之后, <code>filename</code>就派上用场了.</p><p>实现后, 在<code>init_proc()</code>中调用<code>naive_uload(NULL, NULL)</code>, 它会调用你实现的loader来加载第一个用户程序, 然后跳转到用户程序中执行. 如果你的实现正确, 你会看到执行<code>dummy</code>程序时在Nanos-lite中触发了一个未处理的4号事件. 这说明loader已经成功加载dummy, 并且成功地跳转到dummy中执行了. 关于未处理的事件, 我们会在下文进行说明.</p></div><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 检查ELF文件的魔数</h4></span><p>我们知道ELF文件的开头都有一个特殊的魔数, 为了防止loader加载了一个非ELF格式的文件, 我们可以在loader中对魔数进行检查:</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token function">assert</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>elf<span class="token operator">-&gt;</span>e_ident <span class="token operator">==</span> <span class="token number">0xBadC0de</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>你需要把上述的<code>0xBadC0de</code>换成正确的魔数.</p><p>别小看这个表面上很蠢的<code>assert()</code>, 当你哪天手抖不知道做了什么而又被它抓到的时候, 你就知道谢天谢地了.</p></div><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 检测ELF文件的ISA类型</h4></span><p>你很有可能会因为疏忽, 从而让<code>native</code>的Nanos-lite来加载运行一个x86/mips32/riscv32的dummy. 从ISA规范的角度来说, 这种行为显然属于UB, 具体而言通常会发生一些难以理解的错误. 为了避免这种情况, 你可以在loader中检测ELF文件的ISA类型. 我们可以根据AM中定义的一些宏来筛选出预期的ISA类型:</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__ISA_AM_NATIVE__<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">define</span> <span class="token macro-name">EXPECT_TYPE</span> <span class="token expression">EM_X86_64</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__ISA_X86__<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">define</span> <span class="token macro-name">EXPECT_TYPE</span> <span class="token expression"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  </span><span class="token comment">// see /usr/include/elf.h to get the right type</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">error</span> <span class="token expression">Unsupported ISA</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后和ELF信息中的某个域进行对比, 如果发现要加载的ELF文件的ISA类型和预期不一致, 就报错. 如果你不知道AM中的宏在哪里定义, RTFSC. 如果你不知道应该和ELF中的哪个域进行对比, RTFM.</p></div><div class="custom-container c-green"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-lightbulb-o"></i> 将Nanos-lite编译到native</h4></span><p>你可以在<code>native</code>上测试你的Nanos-lite实现是否正确.</p><p>由于<code>native</code>是64位环境, ELF的一些数据结构会与32位有所不同, 但总的来说, ELF的加载过程是一样的. 为了屏蔽数据结构的差异, <code>nanos-lite/src/loader.c</code>中定义了宏<code>Elf_Ehdr</code>和<code>Elf_Phdr</code>, 你可以在loader的实现中使用它们.</p><p>另外为了编译可以在AM native的Nanos-lite上运行的dummy, 你需要在Navy中通过<code>make ISA=am_native</code>来编译. 之后的操作与在<code>$ISA-nemu</code>上运行的操作类似, 即:</p><ol><li>使用<code>ISA=xxx</code>编译dummy</li><li>把编译出的dummy ELF文件作为nanos-lite的ramdisk</li><li>使用<code>ARCH=xxx</code>编译并运行nanos-lite</li></ol><p>Navy中还有一个叫<code>native</code>的ISA, 它与AM中名为<code>native</code>的ARCH机制有所不同, 目前暂不使用.</p></div><h3 id="操作系统的运行时环境" tabindex="-1"><a class="header-anchor" href="3.3.html#操作系统的运行时环境" aria-hidden="true">#</a> 操作系统的运行时环境</h3><p>加载程序之后, 我们就来谈谈程序的运行. 回顾PA2, 我们已经知道, 程序的运行需要运行时环境的支撑. 而操作系统希望加载并运行程序, 自然有责任来提供运行时环境的功能. 在PA2中, 我们根据具体实现是否与ISA相关, 将运行时环境划分为两部分. 但对于运行在操作系统上的程序, 它们就不需要直接与硬件交互了. 那么在操作系统看来, 它应该从什么角度来看这些运行时环境呢?</p><p>注意到运行时环境的部分功能是需要使用资源的, 比如申请内存需要使用物理内存, 更新屏幕需要使用帧缓冲. 在PA2中, 我们的计算机系统是被一个程序独占的, 它可以想怎么玩就怎么玩, 玩坏了也是它一个程序的事情. 而在现代的计算机系统中, 可能会有多个程序并发甚至同时使用计算机系统中的资源. 如果每个程序都直接使用这些资源, 各自都不知道对方的使用情况, 很快整个系统就会乱套了: 比如我覆盖了你的画面, 你覆盖了我的内存空间...</p><p>所以需要有一个角色来对系统中的资源进行统一的管理: 程序不能擅自使用资源了, 使用的时候需要向资源管理者提出申请. 既然操作系统位于高特权级, 享受着至高无上的权利, 自然地它也需要履行相应的义务: 作为资源管理者管理着系统中的所有资源, 操作系统还需要为用户程序提供相应的服务. 这些服务需要以一种统一的接口来呈现, 用户程序也只能通过这一接口来请求服务.</p><p>这一接口就是系统调用. 这是操作系统从诞生那一刻就被赋予的使命: 我们之前提到GM-NAA I/O的一个主要任务就是加载新程序, 而它的另一个主要功能, 就是为程序提供输入输出的公共接口. GM-NAA I/O所提供的公共接口, 可以认为是系统调用的初原形态.</p><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-question-circle"></i> 系统调用的必要性</h4></span><p>对于批处理系统来说, 系统调用是必须的吗? 如果直接把AM的API暴露给批处理系统中的程序, 会不会有问题呢?</p></div><p>于是, 系统调用把整个运行时环境分成两部分, 一部分是操作系统内核区, 另一部分是用户区. 那些会访问系统资源的功能会放到内核区中实现, 而用户区则保留一些无需使用系统资源的功能(比如<code>strcpy()</code>), 以及用于请求系统资源相关服务的系统调用接口.</p><p>在这个模型之下, 用户程序只能在用户区安分守己地&quot;计算&quot;, 任何超越纯粹计算能力之外的任务, 都需要通过系统调用向操作系统请求服务. 如果用户程序尝试进行任何非法操作, CPU就会向操作系统抛出一个异常信号, 让非法操作的指令执行&quot;失败&quot;, 并交由操作系统进行处理. 对, 这就是之前介绍的硬件保护机制, 操作系统需要借助这一天然屏障来阻挡程序的恶意行为.</p><p>虽然操作系统需要为用户程序服务, 但这并不意味着操作系统需要把所有信息都暴露给用户程序. 有些信息是用户进程没有必要知道的, 也永远不应该知道, 例如一些与内存管理相关的数据结构. 如果一个恶意程序获得了这些信息, 可能会为恶意攻击提供了信息基础. 因此, 通常不存在一个系统调用来获取这些操作系统的私有数据.</p><h3 id="系统调用" tabindex="-1"><a class="header-anchor" href="3.3.html#系统调用" aria-hidden="true">#</a> 系统调用</h3><p>那么, 触发一个系统调用的具体过程是怎么样的呢?</p><p>现实生活中的经验可以给我们一些启发: 我们到银行办理业务的时候, 需要告诉工作人员要办理什么业务, 账号是什么, 交易金额是多少, 这无非是希望工作人员知道我们具体想做什么. 用户程序执行系统调用的时候也是类似的情况, 要通过一种方法描述自己的需求, 然后告诉操作系统.</p><p>说起&quot;告诉操作系统&quot;, 你应该马上想起来, 这是通过自陷指令来实现的. 在GNU/Linux中, 用户程序通过自陷指令来触发系统调用, Nanos-lite也沿用这个约定. CTE中的<code>yield()</code>也是通过自陷指令来实现, 虽然它们触发了不同的事件, 但从上下文保存到事件分发, 它们的过程都是非常相似的. 既然我们通过自陷指令来触发系统调用, 那么对用户程序来说, 用来向操作系统描述需求的最方便手段就是使用通用寄存器了, 因为执行自陷指令之后, 执行流就会马上切换到事先设置好的入口, 通用寄存器也会作为上下文的一部分被保存起来. 系统调用处理函数只需要从上下文中获取必要的信息, 就能知道用户程序发出的服务请求是什么了.</p><p>Navy已经为用户程序准备好了系统调用的接口了. <code>navy-apps/libs/libos/src/syscall.c</code>中定义的<code>_syscall_()</code>函数已经蕴含着上述过程:</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token class-name">intptr_t</span> <span class="token function">_syscall_</span><span class="token punctuation">(</span><span class="token class-name">intptr_t</span> type<span class="token punctuation">,</span> <span class="token class-name">intptr_t</span> a0<span class="token punctuation">,</span> <span class="token class-name">intptr_t</span> a1<span class="token punctuation">,</span> <span class="token class-name">intptr_t</span> a2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">asm</span> <span class="token keyword">volatile</span> <span class="token punctuation">(</span>SYSCALL <span class="token operator">:</span> <span class="token string">&quot;=r&quot;</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">(</span>_gpr1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">(</span>_gpr2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">(</span>_gpr3<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">(</span>_gpr4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码会先把系统调用的参数依次放入寄存器中, 然后执行自陷指令. 由于寄存器和自陷指令都是ISA相关的, 因此这里根据不同的ISA定义了不同的宏, 来对它们进行抽象. CTE会将这个自陷操作打包成一个系统调用事件<code>EVENT_SYSCALL</code>, 并交由Nanos-lite继续处理.</p><div class="custom-container c-yellow"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 识别系统调用</h4></span><p>目前<code>dummy</code>已经通过<code>_syscall_()</code>直接触发系统调用, 你需要让Nanos-lite识别出系统调用事件<code>EVENT_SYSCALL</code>.</p><p>你可能需要对多处代码进行修改, 当你为代码无法实现正确而感到疑惑时, 请检查这个过程中的每一个细节. 我们已经强调了很多次, 理解细节是很重要的.</p></div><p>Nanos-lite收到系统调用事件之后, 就会调出系统调用处理函数<code>do_syscall()</code>进行处理. <code>do_syscall()</code>首先通过宏<code>GPR1</code>从上下文<code>c</code>中获取用户进程之前设置好的系统调用参数, 通过第一个参数 - 系统调用号 - 进行分发. 但目前Nanos-lite没有实现任何系统调用, 因此触发了panic.</p><p>添加一个系统调用比你想象中要简单, 所有信息都已经准备好了. 我们只需要在分发的过程中添加相应的系统调用号, 并编写相应的系统调用处理函数<code>sys_xxx()</code>, 然后调用它即可. 回过头来看<code>dummy</code>程序, 它触发了一个<code>SYS_yield</code>系统调用. 我们约定, 这个系统调用直接调用CTE的<code>yield()</code>即可, 然后返回<code>0</code>.</p><p>处理系统调用的最后一件事就是设置系统调用的返回值. 对于不同的ISA, 系统调用的返回值存放在不同的寄存器中, 宏<code>GPRx</code>用于实现这一抽象, 所以我们通过<code>GPRx</code>来进行设置系统调用返回值即可.</p><p>经过CTE, 执行流会从<code>do_syscall()</code>一路返回到用户程序的<code>_syscall_()</code>函数中. 代码最后会从相应寄存器中取出系统调用的返回值, 并返回给<code>_syscall_()</code>的调用者, 告知其系统调用执行的情况(如是否成功等).</p><div class="custom-container c-yellow"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 实现SYS_yield系统调用</h4></span><p>你需要:</p><ol><li>在<code>abstract-machine/am/include/arch/</code>目录下的相应头文件中实现正确的<code>GPR?</code>宏, 让它们从上下文<code>c</code>中获得正确的系统调用参数寄存器.</li><li>添加<code>SYS_yield</code>系统调用.</li><li>设置系统调用的返回值.</li></ol><p>重新运行dummy程序, 如果你的实现正确, 你会看到dummy程序又触发了一个号码为<code>0</code>的系统调用. 查看<code>nanos-lite/src/syscall.h</code>, 你会发现它是一个<code>SYS_exit</code>系统调用. 这说明之前的<code>SYS_yield</code>已经成功返回, 触发<code>SYS_exit</code>是因为dummy已经执行完毕, 准备退出了.</p></div><div class="custom-container c-yellow"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 实现SYS_exit系统调用</h4></span><p>你需要实现<code>SYS_exit</code>系统调用, 它会接收一个退出状态的参数. 为了方便测试, 我们目前先直接使用这个参数调用<code>halt()</code>. 实现成功后, 再次运行dummy程序, 你会看到<code>HIT GOOD TRAP</code>的信息.</p></div><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-question-circle"></i> RISC-V系统调用号的传递</h4></span><p>如果你选择的是RISC-V, 你会发现它并不是通过<code>a0</code>来传递系统调用号. 事实上, 我们参考了RISC-V Linux的系统调用参数传递的约定: 即在RISC-V Linux上也是通过这个寄存器来传递系统调用号的. 你觉得RISC-V Linux为什么没有使用<code>a0</code>来传递系统调用号呢?</p></div><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-comment-o"></i> Linux的系统调用</h4></span><p>你可以通过以下命令查阅Linux系统调用的相关信息:</p><ul><li><code>man syscall</code> - 查阅不同架构的系统调用约定, 包括参数传递和返回值</li><li><code>man syscalls</code> - 查阅Linux中已经实现的系统调用. 噢好多啊, 不过我们在PA中只需要几个系统调用就可以了</li></ul></div><h3 id="系统调用的踪迹-strace" tabindex="-1"><a class="header-anchor" href="3.3.html#系统调用的踪迹-strace" aria-hidden="true">#</a> 系统调用的踪迹 - strace</h3><p>我们已经知道, 在操作系统上运行的用户程序只能做两件事, 一件是进行本地计算, 另一件就是通过系统调用请求操作系统来完成那些本地计算无法完成的工作. 这意味着, 如果我们可以观察系统调用的踪迹(syscall trace), 我们就能对程序的行为有更深入的了解了. Linux上有一个叫<code>strace</code>的工具(可通过<code>apt-get</code>安装), 它可以记录用户程序进行系统调用的踪迹, 我们强烈推荐你安装并尝试使用它. 例如你可以通过<code>strace ls</code>来了解<code>ls</code>的行为, 你甚至可以看到<code>ls</code>是如何被加载的; 如果你对<code>strace</code>本身感兴趣, 你还可以通过<code>strace strace ls</code>来研究<code>strace</code>是如何实现的.</p><p>事实上, 我们也可以在Nanos-lite中实现一个简单的strace: Nanos-lite可以得到系统调用的所有信息, 包括名字, 参数和返回值. 这也是为什么我们选择在Nanos-lite中实现strace: 系统调用是携带高层的程序语义的, 但NEMU中只能看到底层的状态机.</p><div class="custom-container c-yellow"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 实现strace</h4></span><p>在Nanos-lite中实现strace是一个很简单的任务.</p></div><h3 id="操作系统之上的trm" tabindex="-1"><a class="header-anchor" href="3.3.html#操作系统之上的trm" aria-hidden="true">#</a> 操作系统之上的TRM</h3><p>我们已经实现了两个很简单的系统调用了, 那么在当前的Nanos-lite上, 用户程序还可以做什么呢? 你也许想起我们在PA2中是如何对程序的需求分类的了, 那就是AM! 最基本的, TRM向我们展示了, 为了满足程序的基本计算能力, 需要有哪些条件:</p><ul><li>机器提供基本的运算指令</li><li>能输出字符</li><li>有堆区可以动态申请内存</li><li>可以结束运行</li></ul><p>基本的运算指令还是得靠机器提供, 也就是你在PA2中已经实现的指令系统. 至于结束运行, <code>SYS_exit</code>系统调用也已经提供了. 为了向用户程序提供输出字符和内存动态申请的功能, 我们需要实现更多的系统调用.</p><h4 id="标准输出" tabindex="-1"><a class="header-anchor" href="3.3.html#标准输出" aria-hidden="true">#</a> 标准输出</h4><p>在GNU/Linux中, 输出是通过<code>SYS_write</code>系统调用来实现的. 根据<code>write</code>的函数声明(参考<code>man 2 write</code>), 你需要在<code>do_syscall()</code>中识别出系统调用号是<code>SYS_write</code>之后, 检查<code>fd</code>的值, 如果<code>fd</code>是<code>1</code>或<code>2</code>(分别代表<code>stdout</code>和<code>stderr</code>), 则将<code>buf</code>为首地址的<code>len</code>字节输出到串口(使用<code>putch()</code>即可). 最后还要设置正确的返回值, 否则系统调用的调用者会认为<code>write</code>没有成功执行, 从而进行重试. 至于<code>write</code>系统调用的返回值是什么, 请查阅<code>man 2 write</code>. 另外不要忘记在<code>navy-apps/libs/libos/src/syscall.c</code>的<code>_write()</code>中调用系统调用接口函数.</p><p>事实上, 我们平时使用的<code>printf()</code>, <code>cout</code>这些库函数和库类, 对字符串进行格式化之后, 最终也是通过系统调用进行输出. 这些都是&quot;系统调用封装成库函数&quot;的例子. 系统调用本身对操作系统的各种资源进行了抽象, 但为了给上层的程序员提供更好的接口(beautiful interface), 库函数会再次对部分系统调用再次进行抽象. 例如<code>fwrite()</code>这个库函数用于往文件中写入数据, 在GNU/Linux中, 它封装了<code>write()</code>系统调用. 另一方面, 系统调用依赖于具体的操作系统, 因此库函数的封装也提高了程序的可移植性: 在Windows中, <code>fwrite()</code>封装了<code>WriteFile()</code>系统调用, 如果在代码中直接使用<code>WriteFile()</code>系统调用, 把代码放到GNU/Linux下编译就会产生链接错误. 从某种程度上来说, 库函数的抽象确实方便了程序员, 使得他们不必关心系统调用的细节.</p><p>实现<code>SYS_write</code>系统调用之后, 我们已经为&quot;使用<code>printf()</code>&quot;扫除了最大的障碍了, 因为<code>printf()</code>进行字符串格式化之后, 最终会通过<code>write()</code>系统调用进行输出. 这些工作, Navy中的Newlib库已经为我们准备好了.</p><div class="custom-container c-yellow"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 在Nanos-lite上运行Hello world</h4></span><p>Navy中提供了一个<code>hello</code>测试程序(<code>navy-apps/tests/hello</code>), 它首先通过<code>write()</code>来输出一句话, 然后通过<code>printf()</code>来不断输出.</p><p>你需要实现<code>write()</code>系统调用, 然后把Nanos-lite上运行的用户程序切换成<code>hello</code>程序来运行.</p></div><h4 id="堆区管理" tabindex="-1"><a class="header-anchor" href="3.3.html#堆区管理" aria-hidden="true">#</a> 堆区管理</h4><p>你应该已经在程序设计课上使用过<code>malloc()</code>/<code>free()</code>库函数, 它们的作用是在用户程序的堆区中申请/释放一块内存区域. 堆区的使用情况是由libc来进行管理的, 但堆区的大小却需要通过系统调用向操作系统提出更改. 这是因为, 堆区的本质是一片内存区域, 当需要调整堆区大小的时候, 实际上是在调整用户程序可用的内存区域. 事实上, 一个用户程序可用的内存区域是需要经过操作系统的分配和管理的. 想象一下, 如果一个恶意程序可以不经过操作系统的同意, 就随意使用其它程序的内存区域, 将会引起灾难性的后果. 当然, 目前Nanos-lite只是个单任务操作系统, 不存在多个程序的概念. 在PA4中, 你将会对这个问题有更深刻的认识.</p><p>调整堆区大小是通过<code>sbrk()</code>库函数来实现的, 它的原型是</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token class-name">intptr_t</span> increment<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>用于将用户程序的program break增长<code>increment</code>字节, 其中<code>increment</code>可为负数. 所谓program break, 就是用户程序的数据段(data segment)结束的位置. 我们知道可执行文件里面有代码段和数据段, 链接的时候<code>ld</code>会默认添加一个名为<code>_end</code>的符号, 来指示程序的数据段结束的位置. 用户程序开始运行的时候, program break会位于<code>_end</code>所指示的位置, 意味着此时堆区的大小为0. <code>malloc()</code>被第一次调用的时候, 会通过<code>sbrk(0)</code>来查询用户程序当前program break的位置, 之后就可以通过后续的<code>sbrk()</code>调用来动态调整用户程序program break的位置了. 当前program break和和其初始值之间的区间就可以作为用户程序的堆区, 由<code>malloc()</code>/<code>free()</code>进行管理. 注意用户程序不应该直接使用<code>sbrk()</code>, 否则将会扰乱<code>malloc()</code>/<code>free()</code>对堆区的管理记录.</p><p>在Navy的Newlib中, <code>sbrk()</code>最终会调用<code>_sbrk()</code>, 它在<code>navy-apps/libs/libos/src/syscall.c</code>中定义. 框架代码让<code>_sbrk()</code>总是返回<code>-1</code>, 表示堆区调整失败, 事实上, 用户程序在第一次调用<code>printf()</code>的时候会尝试通过<code>malloc()</code>申请一片缓冲区, 来存放格式化的内容. 若申请失败, 就会逐个字符进行输出. 如果你在Nanos-lite中打开strace, 你会发现用户程序通过<code>printf()</code>输出的时候, 确实是逐个字符地调用<code>write()</code>来输出的.</p><p>但如果堆区总是不可用, Newlib中很多库函数的功能将无法使用, 因此现在你需要实现<code>_sbrk()</code>了. 为了实现<code>_sbrk()</code>的功能, 我们还需要提供一个用于设置堆区大小的系统调用. 在GNU/Linux中, 这个系统调用是<code>SYS_brk</code>, 它接收一个参数<code>addr</code>, 用于指示新的program break的位置. <code>_sbrk()</code>通过记录的方式来对用户程序的program break位置进行管理, 其工作方式如下:</p><ol><li>program break一开始的位置位于<code>_end</code></li><li>被调用时, 根据记录的program break位置和参数<code>increment</code>, 计算出新program break</li><li>通过<code>SYS_brk</code>系统调用来让操作系统设置新program break</li><li>若<code>SYS_brk</code>系统调用成功, 该系统调用会返回<code>0</code>, 此时更新之前记录的program break的位置, 并将旧program break的位置作为<code>_sbrk()</code>的返回值返回</li><li>若该系统调用失败, <code>_sbrk()</code>会返回<code>-1</code></li></ol><p>上述代码是在用户层的库函数中实现的, 我们还需要在Nanos-lite中实现<code>SYS_brk</code>的功能. 由于目前Nanos-lite还是一个单任务操作系统, 空闲的内存都可以让用户程序自由使用, 因此我们只需要让<code>SYS_brk</code>系统调用总是返回<code>0</code>即可, 表示堆区大小的调整总是成功. 在PA4中, 我们会对这一系统调用进行修改, 实现真正的内存分配.</p><div class="custom-container c-yellow"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 实现堆区管理</h4></span><p>根据上述内容在Nanos-lite中实现<code>SYS_brk</code>系统调用, 然后在用户层实现<code>_sbrk()</code>. 你可以通过<code>man 2 sbrk</code>来查阅libc中<code>brk()</code>和<code>sbrk()</code>的行为, 另外通过<code>man 3 end</code>来查阅如何使用<code>_end</code>符号.</p><p>需要注意的是, 调试的时候不要在<code>_sbrk()</code>中通过<code>printf()</code>进行输出, 这是因为<code>printf()</code>还是会尝试通过<code>malloc()</code>来申请缓冲区, 最终会再次调用<code>_sbrk()</code>, 造成死递归. 你可以通过<code>sprintf()</code>先把调试信息输出到一个字符串缓冲区中, 然后通过<code>_write()</code>进行输出.</p><p>如果你的实现正确, 你可以借助strace看到<code>printf()</code>不再是逐个字符地通过<code>write()</code>进行输出, 而是将格式化完毕的字符串通过一次性进行输出.</p></div><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-comment-o"></i> 缓冲区与系统调用开销</h4></span><p>你已经了解系统调用的过程了. 事实上, 如果通过系统调用千辛万苦地陷入操作系统只是为了输出区区一个字符, 那就太不划算了. 于是有了批处理(batching)的技术: 将一些简单的任务累积起来, 然后再一次性进行处理. 缓冲区是批处理技术的核心, libc中的<code>fread()</code>和<code>fwrite()</code>正是通过缓冲区来将数据累积起来, 然后再通过一次系统调用进行处理. 例如通过一个1024字节的缓冲区, 就可以通过一次系统调用直接输出1024个字符, 而不需要通过1024次系统调用来逐个字符地输出. 显然, 后者的开销比前者大得多.</p><p>有兴趣的同学可以在GNU/Linux上编写相应的程序, 来粗略测试一下一次<code>write()</code>系统调用的开销, 然后和<a href="http://arkanis.de/weblog/2017-01-05-measurements-of-system-call-performance-and-overhead" target="_blank" rel="noopener noreferrer">这篇文章<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>对比一下.</p></div><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-comment-o"></i> printf和换行</h4></span><p>我们在PA1的时候提示过大家, 使用<code>printf()</code>调试时需要添加<code>\n</code>, 现在终于可以解释为什么了: <code>fwrite()</code>的实现中有缓冲区, <code>printf()</code>打印的字符不一定会马上通过<code>write()</code>系统调用输出, 但遇到<code>\n</code>时可以强行将缓冲区中的内容进行输出. 有兴趣的同学可以阅读<code>navy-apps/libs/libc/src/stdio/wbuf.c</code>, 这个文件实现了缓冲区的功能.</p></div><p>实现了这两个系统调用之后, 原则上所有TRM上能运行的程序, 现在都能在Nanos-lite上运行了. 不过我们目前并没有严格按照AM的API来将相应的系统调用功能暴露给用户程序, 毕竟与AM相比, 对操作系统上运行的程序来说, libc的接口更加广为人们所用, 我们也就不必班门弄斧了.</p><div class="custom-container c-yellow"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 必答题(需要在实验报告中回答) - hello程序是什么, 它从而何来, 要到哪里去</h4></span><p>到此为止, PA中的所有组件已经全部亮相, 整个计算机系统也开始趋于完整. 你也已经在这个自己创造的计算机系统上跑起了hello这个第一个还说得过去的用户程序 (dummy是给大家热身用的, 不算), 好消息是, 我们已经距离运行仙剑奇侠传不远了(下一个阶段就是啦).</p><p>不过按照PA的传统, 光是跑起来还是不够的, 你还要明白它究竟怎么跑起来才行. 于是来回答这道必答题吧:</p><blockquote><p>我们知道<code>navy-apps/tests/hello/hello.c</code>只是一个C源文件, 它会被编译链接成一个ELF文件. 那么, hello程序一开始在哪里? 它是怎么出现内存中的? 为什么会出现在目前的内存位置? 它的第一条指令在哪里? 究竟是怎么执行到它的第一条指令的? hello程序在不断地打印字符串, 每一个字符又是经历了什么才会最终出现在终端上?</p></blockquote><p>上面一口气问了很多问题, 我们想说的是, 这其中蕴含着非常多需要你理解的细节. 我们希望你能够认真整理其中涉及的每一行代码, 然后用自己的语言融会贯通地把这个过程的理解描述清楚, 而不是机械地分点回答这几个问题.</p><p>同样地, 上一阶段的必答题&quot;理解穿越时空的旅程&quot;也已经涵盖了一部分内容, 你可以把它的回答包含进来, 但需要描述清楚有差异的地方. 另外, C库中<code>printf()</code>到<code>write()</code>的过程比较繁琐, 而且也不属于PA的主线内容, 这一部分不必展开回答. 而且你也已经在PA2中实现了自己的<code>printf()</code>了, 相信你也不难理解字符串格式化的过程. 如果你对Newlib的实现感兴趣, 你也可以RTFSC.</p><p>总之, 扣除C库中<code>printf()</code>到<code>write()</code>转换的部分, 剩下的代码就是你应该理解透彻的了. 于是, 努力去理解每一行代码吧!</p></div><div class="custom-container c-blue"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-edit"></i> 支持多个ELF的ftrace</h4></span><p>如果我们想了解C库中<code>printf()</code>到<code>write()</code>的过程, ftrace将是一个很好的工具. 但我们知道, Nanos-lite和它加载的用户程序是两个独立的ELF文件, 这意味着, 如果我们给NEMU的ftrace指定其中一方的ELF文件, 那么ftrace就无法正确将另一方的地址翻译成正确的函数名. 事实上, 我们可以让NEMU的ftrace支持多个ELF: 如果一个地址不属于某个ELF中的任何一个函数, 那就尝试下一个ELF. 通过这种方式, ftrace就可以同时追踪Nanos-lite和用户程序的函数调用了.</p></div><div class="custom-container c-green"><span class="custom-container-title"><h4 style="display:inline;"><i class="fa fa-lightbulb-o"></i> 温馨提示</h4></span><p>PA3阶段2到此结束.</p></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="3.2.html" class="" aria-label="穿越时空的旅程"><!--[--><!--]--> 穿越时空的旅程 <!--[--><!--]--></a></span><span class="next"><a href="3.4.html" class="" aria-label="简易文件系统"><!--[--><!--]--> 简易文件系统 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="../assets/app.4a525931.js" defer></script>
  </body>
</html>
